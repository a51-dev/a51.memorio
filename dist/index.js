"use strict";(()=>{var f={name:"dispatch",active:!0,subCommand:[{name:"set",version:"0.0.1",example:"memorio.dispatch.set([name, value])",author:"Dario Passariello",creationDate:"20231231",lastMod:"20240612",type:"function",active:!0,description:"Dispatches a custom event with the specified name and value.",subCommand:[]},{name:"listen",version:"0.0.1",example:"memorio.dispatch.listen([eventNames, callback=null], flag = true)",author:"Dario Passariello",creationDate:"20231231",lastMod:"20240612",type:"function",active:!0,description:"Listens for the specified event names and executes the callback when the event is triggered.",subCommand:[]},{name:"remove",version:"0.0.1",example:"memorio.dispatch.remove([eventNames, callback=null], flag = true)",author:"Dario Passariello",creationDate:"20231231",lastMod:"20240612",type:"function",active:!0,description:"Removes the event listener for the specified event names.",subCommand:[]}]},m={set:(e,t={})=>{dispatchEvent(new CustomEvent(String(e),t))},listen:(e,t=null,s=!1)=>{observer.list?.[e]?.length>0&&observer.remove(e);let i=r=>t?setTimeout(()=>t(r),0):null;globalThis.events[e]=i},remove:e=>{globalThis.events.name=""}};memorio.setDescription(f,m);Object.defineProperty(globalThis,"store",{value:new Proxy({},{}),enumerable:!1,configurable:!1});Object.defineProperties(store,{get:{value(e){if(e)try{let t=localStorage.getItem(e);return t&&JSON.parse(t)}catch(t){console.error(`Error parsing store item "${e}":`,t)}}},set:{value(e,t){if(e)try{t==null?localStorage.setItem(e,JSON.stringify(null)):typeof t=="object"||typeof t=="number"||typeof t=="boolean"||typeof t=="string"?localStorage.setItem(e,JSON.stringify(t)):typeof t=="function"&&console.error("It's not secure to store functions.")}catch(s){console.error(`Error setting store item "${e}":`,s)}}},remove:{value(e){if(e&&localStorage.getItem(e))return localStorage.removeItem(e),!0}},delete:{value(e){store.remove(e)}},removeAll:{value(){return localStorage.clear(),!0}},clearAll:{value(){return store.removeAll(),!0}},quota:{value(){"storage"in navigator&&"estimate"in navigator.storage&&navigator.storage.estimate().then(({usage:e,quota:t})=>{e&&t&&console.debug(`Using ${e/1024} out of ${t/1024} Mb.`)}).catch(e=>{console.error("Error estimating quota:",e)})}},size:{value(){let e=0;for(let t in localStorage)if(localStorage.hasOwnProperty(t)){let s=localStorage.getItem(t);s&&(e+=s.length)}return e}}});Object.freeze(store);var c=(e,t,s=[])=>{let i=r=>{let o=r.split("-");o.forEach((n,a)=>{let l=o.slice(0,a+1).join("-");memorio.dispatch.set(l,{detail:{name:l}})})};return new Proxy(e,{get(r,o){if(Object.isFrozen(r[o]))return r[o];try{let n=Reflect.get(r,o);return n&&typeof n=="object"&&["Array","Object"].includes(n.constructor.name)?c(n,t,s.concat(o)):n}catch(n){return console.error("Error: ",n),!1}},set(r,o,n){if(r[o]&&typeof r[o]=="object"&&Object.isFrozen(r[o])){console.error(`Error: state "${o}" is locked`);return}try{let a=memorio.obj.path(o,s);return t({action:"set",path:a,target:r,newValue:n,previousValue:Reflect.get(r,o)}),i("state-"+a.replaceAll(".","-")),Reflect.set(r,o,n),r[o]&&typeof r[o]=="object"&&Reflect.defineProperty(r[o],"lock",{value(){Object.defineProperty(r,o,{writable:!1,enumerable:!1}),Object.freeze(r[o])}}),!0}catch(a){return console.error("Error in set trap:",a),!1}},deleteProperty(r,o){try{let n=memorio.obj.path(o,s);return t({action:"delete",path:n,target:r}),Reflect.deleteProperty(r,o)}catch(n){return console.error("Error in deleteProperty trap:",n),!1}}})};globalThis?.state?globalThis.state=state:globalThis.state=c({},()=>{});var u=new WeakSet;u.add(state);setInterval(()=>{if(!u.has(state)){alert("memorio State is compromised, check if you override it and please reload the page");for(let e=1;e<99999;e++)clearInterval(e);stop()}},1e3);Object.defineProperty(globalThis,"state",{enumerable:!1,configurable:!1});Object.defineProperties(state,{list:{get(){let e=memorio.array.deepClone(state);console.info(e)}},remove:{value(e){e in state?(delete state[e],console.debug(`State '${e}' deleted`)):console.error(`'${e}' not exist`)},writable:!1,configurable:!1},removeAll:{value(){state.forEach(e=>{delete state[e[0]]})},writable:!1,configurable:!1}});globalThis.observer||(globalThis.observer=null);Object.defineProperty(globalThis,"observer",{enumerable:!1});observer=(e,t=null,s=!0)=>{if((r=>r.split(".")[0]!=="state"?(console.error(`Observer Error: You need to declare "state." or "store.". The "${r}" string is incorrect!`),!1):!0)(e)){if(!e&&!t){console.error("Observer Error: You need to setup observer correctly, Some parameters are missed!");return}if(!e&&t){console.error('Observer Error: You need to declare what state need to be monitored as string like "state.test".');return}if(e&&!t){memorio.dispatch.listen(String(e),{detail:{name:String(e)}}),console.debug("called: ",e);return}if(e&&t){if(typeof e!="string"||typeof t!="function"){console.error('Observer Error: name of state need to be a "string" like "state.test" and the callback need to be a "function"');return}let r=e.replaceAll(".","-");memorio.dispatch.listen(r,t,s);return}}};Object.defineProperties(observer,{list:{get:()=>globalThis.events},remove:{value:e=>{e&&(globalThis.events[e]="")}},removeAll:{get:()=>{Object.entries(observer.list).forEach(e=>{globalThis.events[e[0]]})}}});Object.freeze(observer);})();
